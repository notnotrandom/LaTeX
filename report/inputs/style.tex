% Style commands go here.

% Make the page a bit wider. Requires package geometry.
\geometry{top=2.5cm, bottom=2.5cm, left=3.0cm, right=3.0cm}

% Use endnotes for regular chapters, and footnotes for appendix. Also,
% \footnote{text} produces a footnote, using a symbol, to avoid confusion with
% endnotes.
\let\oldappendix\appendix
\renewcommand*{\thefootnote}{\fnsymbol{footnote}}
\renewcommand{\appendix}{\let\nn\footnote\oldappendix}

% --- Setup enotez package ---
\setenotez{
  backref=true,
  totoc=chapter,
  counter-format=arabic,
  reset=true,
  split=chapter,
  split-title={<ref>. <title>}
}

\NewSplitTitleTag{title}{\nameref*{ch:<split-level-id>}}

% Requires package letltxmacro. Create a counter for numbered chapters, to be
% able to show chapter names in Notes' listing.
\LetLtxMacro\origchapter\chapter
\RenewDocumentCommand\chapter{som}{%
  \IfBooleanTF{#1}
    {% starred chapter, no label then
      \origchapter*{#3}%
    }
    {% else add a label
      \IfNoValueTF{#2}
        {\origchapter{#3}}
        {\origchapter[#2]{#3}}%
      \expanded{\noexpand\label{ch:\thechapter}}%
    }%
}

% This is needed before setting up fancyhdr, to get the page header right in
% the Notes' chapter (this is only relevant when said chapter has more than one
% page...)
\setenotez{list-heading=\chapter*{#1\markboth{#1}{}}}

% Left-align start of note with the respective chapter heading.
\DeclareInstance{enotez-list}{plain}{paragraph}{format=\footnotesize\leftskip1.25em}
% --- END Setup enotez package ---

% Proper format of caption text.
% Requires package caption.
\captionsetup{font=small, labelfont=bf}

% To indicate current chapter name and number in the header.
% Requires package fancyhdr.
\pagestyle{fancy}
\cfoot{} % Get rid of the page number in the footer.
\makeatletter
\renewcommand{\chaptermark}[1]{\markboth{%
  \ifnum\c@secnumdepth > \m@ne \@chapapp\ \thechapter\ --\ \fi #1}{}}
\makeatother
\fancyhead[R]{}
\fancyhead[L]{\fontsize{10}{12}\selectfont\leftmark \hfill \thepage}

% Remove original page numbers (bottom, centered).
\cfoot{}
% Do the same for the page number in the chapter opening page (\cfoot{} leaves
% those..).
\fancypagestyle{plain}{%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhf{}%
}

% For fancy chapter header.
% Requires packages titlesec, blindtext, color.
\definecolor{gray75}{gray}{0.75}
\newcommand*{\hsp}{\hspace{20pt}}
\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries}

% To avoid fancy header in pages after the first, in TOC and bibliography.
\let\origtoc\tableofcontents
\renewcommand*{\tableofcontents}{%
  \hypersetup{linkcolor=black}%
  \origtoc\chaptermark{Contents}\cleardoublepage\hypersetup{linkcolor=MidnightBlue}}

\let\bibliographyorig\bibliography
\renewcommand*{\bibliography}[1]{%
  \bibliographyorig{#1}\chaptermark{References}\cleardoublepage}

% Uncomment when using an index. Makes the font small.
% \let\printindexorig\printindex
% \renewcommand*{\printindex}{%
%   \footnotesize\printindexorig\cleardoublepage}

% Proper format of caption text.
% Requires package caption.
\captionsetup{font=small, labelfont=bf}

% --- Reduce the spacing between items in environments that use items. ---
\let\oldenumerate\enumerate
\let\oldenumerateend\endenumerate
\renewenvironment{enumerate}{\oldenumerate\setlength{\itemsep}{0.25em} \setlength{\parskip}{0pt}}{\oldenumerateend}

\let\olditemize\itemize
\let\olditemizeend\enditemize
\renewenvironment{itemize}{\olditemize\setlength{\itemsep}{0.25em} \setlength{\parskip}{0pt}}{\olditemizeend}
% --- END Reduce the spacing between items in environments that use items. ---
